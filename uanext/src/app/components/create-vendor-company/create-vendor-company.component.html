<mat-progress-bar *ngIf="showProgressBar" mode="indeterminate" class="progress-bar-fixed"></mat-progress-bar>

<div class="container">

  <form [formGroup]="vendorCompanyForm" (ngSubmit)="onSubmit()">
    <h2>Create new project</h2>
    <div class="row">
      <div class="col-6 col-md-4 form-group avatar">
        <div class="avatar-img-wrapper">
          <img #avatar2 height=100 src={{FormHelper.emptyAvatar}} alt="avatar">
          <mat-progress-bar *ngIf="showAvatarProgress === true" mode="indeterminate"></mat-progress-bar>
        </div>

        <div *ngIf="(submitted && formControls.avatar.errors) || (avatarIsTouched && formControls.avatar.errors)" class="avatar-invalid-feedback">
          <div *ngIf="formControls.avatar.errors.required">Avatar cannot be empty</div>
          <div *ngIf="formControls.avatar.errors.maxAvatarSizeErr">Max avatar size is 5Mb</div>
          <div *ngIf="formControls.avatar.errors.avatarNotUploaded">Upload selected avatar</div>
        </div>

        <div class="select-avatar-input">
          <button type="button" class="btn btn-primary">Choose avatar</button>
          <input (change)="handleAvatarSelect($event)" type="file" accept="image/*" formControlName="avatar" class="form-control"
            [ngClass]="{ 'is-invalid': (submitted && formControls.avatar.errors) || (avatarIsTouched && formControls.avatar.errors)}">
        </div>

        <button type="button" (click)="uploadAvatar()" class="btn btn-primary">Upload avatar</button>
      </div>

      <div class="col-lg-4 col-md-6">
        <div class="form-group">
          <label>Project name</label>
          <input type="text" formControlName="name" class="form-control" [ngClass]="{ 'is-invalid': submitted && formControls.name.errors }"
            placeholder="Enter project name" />
          <div *ngIf="formControls.name.errors" class="invalid-feedback">
            <div *ngIf="formControls.name.errors.required">Project name cannot be empty</div>
          </div>
        </div>

        <div class="form-group">
          <label>Company name</label>
          <input type="text" formControlName="legalEntityName" class="form-control" [ngClass]="{ 'is-invalid': submitted && formControls.legalEntityName.errors }"
            placeholder="Enter company name" />
          <div *ngIf="formControls.legalEntityName.errors" class="invalid-feedback">
            <div *ngIf="formControls.legalEntityName.errors.required">Company name cannot be empty</div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="form-group col-md-10 col-12">
        <label for="vendor-goal-textarea">Describe why you need investments</label>
        <textarea id="vendor-goal-textarea" rows="3" formControlName="goal" class="form-control" [ngClass]="{ 'is-invalid': submitted && formControls.goal.errors }"
          placeholder="What do you want to realize through investment?"></textarea>
        <div *ngIf="formControls.goal.errors" class="invalid-feedback">
          <div *ngIf="formControls.goal.errors.required">Investments cannot be empty</div>
          <div *ngIf="formControls.goal.errors.minlength">Minimal length is 200 charset</div>
          <div *ngIf="formControls.goal.errors.maxlength">Maximal length is 1024 charset</div>
        </div>
      </div>
      <div class="col-12 pl-0 pr-0">
        <app-steps [parentSubmitted]="submitted" [minItemsCount]=3 [maxItemsCount]=15 (itemsEvent)="stepsEventHandler($event)"></app-steps>
      </div>
    </div>

    <hr>

    <div class="row">
      <h6 class="col-12">Address</h6>
      <div class="form-group col-lg-4 col-md-6 col-12">
        <label>Region</label>
        <input type="text" formControlName="region" class="form-control" [ngClass]="{ 'is-invalid': submitted && formControls.region.errors }"
          placeholder="Enter region" />
        <div *ngIf="formControls.region.errors" class="invalid-feedback" aria-placeholder="Enter region">
          <div *ngIf="formControls.region.errors.required">Region cannot be empty</div>
        </div>
      </div>
      <div class="form-group col-lg-4 col-md-6 col-12">
        <label>Full address</label>
        <input type="text" formControlName="address" class="form-control" [ngClass]="{ 'is-invalid': submitted && formControls.address.errors }"
          placeholder="Enter full address" />
        <div *ngIf="formControls.address.errors" class="invalid-feedback" aria-placeholder="Enter full address">
          <div *ngIf="formControls.address.errors.required">Address cannot be empty</div>
        </div>
      </div>
    </div>

    <hr>

    <div class="row">
      <h6 class="col-12">About company</h6>
      <div class="form-group col-lg-3 col-md-6">
        <label>Employees number</label>
        <select type="number" min=0 formControlName="employeesNumber" class="form-control" [ngClass]="{ 'is-invalid': submitted && formControls.employeesNumber.errors }">
          <option value="1">0-1</option>
          <option value="5">2-5</option>
          <option value="10">6-10</option>
          <option value="25">11-25</option>
          <option value="50">26-50</option>
          <option value="100">51-100</option>
          <option value="101">100+</option>
        </select>
        <div *ngIf="formControls.employeesNumber.errors" class="invalid-feedback">
          <div *ngIf="formControls.employeesNumber.errors.required">Specify employees number</div>
        </div>
      </div>
      <div class="form-group col-lg-3 col-md-6">
        <label>Employees to hire</label>
        <input type="number" min=0 formControlName="employeesToHire" class="form-control" [ngClass]="{ 'is-invalid': submitted && formControls.employeesToHire.errors }"
          placeholder="Enter count employees to hire" />
        <div *ngIf="formControls.employeesToHire.errors" class="invalid-feedback">
          <div *ngIf="formControls.employeesToHire.errors.required">Specify count employees to hire</div>
        </div>
      </div>
      <div class="form-group col-lg-3 col-md-6">
        <label>Field of activity</label>
        <input type="text" formControlName="fieldOfActivity" class="form-control" [ngClass]="{ 'is-invalid': submitted && formControls.fieldOfActivity.errors }"
          placeholder="Enter field of activity" />
        <div *ngIf="formControls.fieldOfActivity.errors" class="invalid-feedback">
          <div *ngIf="formControls.fieldOfActivity.errors.required">Field of activity cannot be empty</div>
        </div>
      </div>
      <div class="form-group col-lg-3 col-md-6">
        <label>Company age</label>
        <input type="number" min=0 formControlName="companyAge" class="form-control" [ngClass]="{ 'is-invalid': submitted && formControls.companyAge.errors }"
          placeholder="Enter company age" />
        <div *ngIf="formControls.companyAge.errors" class="invalid-feedback">
          <div *ngIf="formControls.companyAge.errors.required">Company age cannot be empty</div>
        </div>
      </div>
    </div>


    <div class="row">
      <div class="form-group col-lg-3 col-md-6">
        <label>Average check</label>
        <input type="number" formControlName="averageCheck" class="form-control" [ngClass]="{ 'is-invalid': submitted && formControls.averageCheck.errors }"
          placeholder="Enter average check" />
        <div *ngIf="formControls.averageCheck.errors" class="invalid-feedback">
          <div *ngIf="formControls.averageCheck.errors.required">Average check cannot be empty</div>
        </div>
      </div>
      <div class="form-group col-lg-3 col-md-6">
        <label>Clients count per month</label>
        <input type="number" formControlName="mounthlyClients" class="form-control" [ngClass]="{ 'is-invalid': submitted && formControls.mounthlyClients.errors }"
          placeholder="Enter clients count per mount" />
        <div *ngIf="formControls.mounthlyClients.errors" class="invalid-feedback">
          <div *ngIf="formControls.mounthlyClients.errors.required">Clients count per month cannot be empty</div>
        </div>
      </div>
      <div class="form-group col-lg-3 col-md-6">
        <label>Average price</label>
        <input type="number" formControlName="averagePrice" class="form-control" [ngClass]="{ 'is-invalid': submitted && formControls.averagePrice.errors }"
          placeholder="Enter average price" />
        <div *ngIf="formControls.averagePrice.errors" class="invalid-feedback">
          <div *ngIf="formControls.averagePrice.errors.required">Average price cannot be empty</div>
        </div>
      </div>
      <div class="form-group col-lg-3 col-md-6">
        <label>Gross income</label>
        <select type="number" min=0 formControlName="grossIncome" class="form-control" [ngClass]="{ 'is-invalid': submitted && formControls.grossIncome.errors }">
          <option value="0">0</option>
          <option value="100">100</option>
        </select>
        <div *ngIf="formControls.grossIncome.errors" class="invalid-feedback">
          <div *ngIf="formControls.grossIncome.errors.required">Specify gross income</div>
        </div>
      </div>
    </div>

    <hr>

    <div class="row">
      <h6 class="col-12">Investments</h6>
      <div class="form-group col-md-10 col-12">
        <label>Describe your business</label>
        <textarea rows=3 type="text" formControlName="description" class="form-control" [ngClass]="{ 'is-invalid': submitted && formControls.description.errors }"
          placeholder="Please briefly describe your business"></textarea>
        <div *ngIf="formControls.description.errors" class="invalid-feedback">
          <div *ngIf="formControls.description.errors.required">Business description cannot be empty</div>
          <div *ngIf="formControls.description.errors.maxlength">Business description length cannot be
            largest than 1024 chars</div>
        </div>
      </div>
      <div class="form-group col-md-6 col-xl-4 col-12">
        <label>How much money required</label>
        <input type="number" formControlName="moneyRequired" class="form-control" placeholder="Enter amount" [ngClass]="{ 'is-invalid': submitted && formControls.moneyRequired.errors }" />
        <div *ngIf="formControls.moneyRequired.errors" class="invalid-feedback">
          <div *ngIf="formControls.moneyRequired.errors.required">Specify how much money required</div>
        </div>
      </div>
      <div class="form-group col-md-10 col-12">
        <label>Describe in detail how, for what and in what period you plan to spend money</label>
        <textarea rows=3 placeholder="Please enter information on how you plan to use the funds received"
          formControlName="investmentDescription" class="form-control" [ngClass]="{ 'is-invalid': submitted && formControls.investmentDescription.errors }"></textarea>
        <div *ngIf="formControls.investmentDescription.errors" class="invalid-feedback">
          <div *ngIf="formControls.investmentDescription.errors.required">Investment description cannot be empty</div>
          <div *ngIf="formControls.investmentDescription.errors.maxlength">Investment description length cannot be
            largest than 4096 chars</div>
        </div>
      </div>
    </div>

    <hr>

    <div class="row">
      <h6 class="col-12">Media</h6>
      <div class="col-12 pl-0 pr-0">
        <app-videos [parentSubmitted]="submitted" [minItemsCount]=1 [maxItemsCount]=10 (itemsEvent)="videosEventHandler($event)"></app-videos>
      </div>

      <div class="form-group col-lg-6 col-12">
        <div class="project-photos">
          <div class="mb-2">Uploaded photos</div>
          <ul class="list-group">
            <li *ngFor="let photo of vendorCompany.images" class="list-group-item">
              <div class="d-flex justify-content-between">
                <div class="d-flex align-items-end">
                  <img src={{photo.url}} alt="">
                  <div class="position-relative">
                    <div class="extension">{{ photo.name.split('.').pop() }}</div>
                  </div>
                </div>
                <button (click)="removePhotoItem(photo)" type="button" class="close" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
            </li>
          </ul>
          <div *ngIf="submitted && (vendorCompany.images.length < minPhotosCount)" class="min-files-count">Minimal
            photos count is {{minPhotosCount}}</div>
        </div>
        <div class="photos-uploader">
          <app-file-uploader [parentSubmitted]="submitted" accept="image/*" content="photos" (filesUploadedEvent)="photosUploaded($event)"></app-file-uploader>
        </div>
        <input style="display:none" type="text" formControlName="forPhotos" />
      </div>

      <div class="form-group col-lg-6 col-12">
        <div class="project-files">
          <div class="mb-2">Uploaded files</div>
          <ul class="list-group">
            <li *ngFor="let file of vendorCompany.files" class="list-group-item">
              <div class="d-flex justify-content-between">
                <div class="d-flex align-items-end">
                  <img src="../../../assets/img/file.png" alt="">
                  <div class="position-relative">
                    <div class="extension">{{ file.name.split('.').pop() }}</div>
                  </div>
                </div>
                <button (click)="removeFileItem(file)" type="button" class="close" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
            </li>
          </ul>
        </div>
        <div class="files-uploader">
          <app-file-uploader [parentSubmitted]="submitted" accept="{{FormHelper.acceptFilesTypes}}" content="files"
            (filesUploadedEvent)="filesUploaded($event)"></app-file-uploader>
        </div>
        <input style="display:none" type="text" formControlName="forFiles" />
      </div>
    </div>


    <div class="form-group">
      <button [disabled]="submitted && !vendorCompanyForm.valid" class="btn btn-success">Create project</button>
    </div>
  </form>

</div>


<!-- todo removw -->
<button (click)="getFormControls()">getFormControls</button>
